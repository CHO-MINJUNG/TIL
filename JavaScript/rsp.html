<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>가위바위보</title>
  <style>
    #computer{
        width: 142px;
        height: 200px;
    }
  </style>
</head>
<body>
<div id="computer"></div>
<div>
  <button id="scissors">가위</button>
  <button id="rock">바위</button>
  <button id="paper">보</button>
</div>
<div id="score">0</div>
<script>
  const $computer = document.querySelector('#computer');
  const $score = document.querySelector('#score');
  const $rock = document.querySelector('#rock');
  const $scissors = document.querySelector('#scissors');
  const $paper = document.querySelector('#paper');
  const IMG_URL = './rsp.png';
  $computer.style.background = `url(${IMG_URL}) 0 0`;
  $computer.style.backgroundSize = 'auto 200px';

  const rspX = {
    scissors:'0', //가위
    rock: '-220px', //바위
    paper: '-440px' //보
  };

  let computerChoice = 'scissors';
  const changeComputerHand = () => {
    //background와 backgroundSize는 항상 같이 적어줘야함(backgroundSize가 리셋되기 때문)
    if(computerChoice===rspX.scissors){ //가위
      computerChoice='rock';
    } else if (computerChoice === rspX.rock){ //바위
      computerChoice = 'paper'; 
    }else if(computerChoice ===rspX.paper ){ //보
      computerChoice = 'scissors';
    }
    $computer.style.background=`url(${IMG_URL}) ${rspX[computerChoice]} 0`;
    $computer.style.backgroundSize='auto 200px';
  }
  //setInterval 함수는 반환값이 존재함. 이 반환값을 사용해 나중에 타이머를 제거할 수 있음
  //또 타이머는 타이머마다 각각의 id를 가진다. 임의의 타이머는 고유한 id를 가진다
  let intervalId = setInterval(changeComputerHand,50);
  const scoreTable = {
    rock: 0,
    scissors:1,
    paper:-1
  };
  let clickable = true;
  const clickButton =()=>{
    if (clickable){
      clearInterval(intervalId);
      clickable=false;
      //점수 계산 및 화면 표시

      const myChoice = event.target.textContent === '바위'
        ? 'rock'
        : event.target.textContent === '가위'
          ? 'scissors'
          : 'paper';

      // diff === '고양이' || diff ==='사자' || diff === '강아지'
      //  => ['고양이', '사자', '강아지'].includes(diff) 이렇게 바꿔쓰면 더 효율적! {ture, false}
      const myScore = scoreTable[myChoice];
      const computerScore = scoreTable[computerChoice];
      const diff = myScore - computerScore;

      // 2,-1은 승리조건이고, -2, 1은 패배조건
      if ([2,-1].includes(diff)){
        console.log('승리');
      } else if ([-2,1].includes(diff)){
        console.log('패배');
      } else{
        console.log('무승부');
      }
      //이 버튼을 계속 클릭하면 setTimeout이 여러번 실행되기 때문에 속도가 너무 빨라지는 버그가 생긴다
      //setTimeout이 1초로 설정되어 있으므로 최소한 1초 후에 클릭해야 문제 없다
      //but 1초안에 클릭한다면 문제 발생!
      setTimeout(()=>{
        clickable = true;
        //버그의 문제로 clear한번 더 해주기
        //혹은 removeEventListener를 이용해 1초동안 다른 버튼들이 클릭이 안 되도록 막아서 버그를 방지하는 방식도 있다
        //혹은 TF 변수를 추가해서 버그 방지 가능
        intervalId = setInterval(changeComputerHand,50);
      },1000);
    }
  };
  $rock.addEventListener('click',clickButton);
  $scissors.addEventListener('click',clickButton);
  $paper.addEventListener('click',clickButton);
  
</script>
</body>
</html>